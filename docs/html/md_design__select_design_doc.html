<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cosan: Model Selection and Evaluation Design Document V1.0</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cosan
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Data Analytics Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_design__select_design_doc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Model Selection and Evaluation Design Document V1.0 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md54"></a>
Introduction</h1>
<p>The main purpose of this part is to offer tools to evaluate the linear models with the preprocessed data. </p>
<h4><a class="anchor" id="autotoc_md55"></a>
CosanMetric:</h4>
<p>A class for error computing. \ We will implement four different metrics to measure the error rates of the predicted labels from linear models. Error rates are computed by comparing the difference between the predicted labels and test labels. Different metrics use different error rate equations. These metrics are <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#max-error">max error</a>, <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#mean-absolute-error">mean absolute error</a>, <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#mean-squared-error">mean squared error</a>, and <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#r2-score-the-coefficient-of-determination">r2 score</a>. </p>
<h4><a class="anchor" id="autotoc_md56"></a>
CrossValidate:</h4>
<p>A static function for cross validation. \ Cross validation is commonly used to avoid model overfitting. Model overfitting happens when a model produces low error rates on seen data but performs poorly on unseen data. \ We choose to implement k-fold cross validation. This algorithm uses 1/k of the data set as the test set in k runs of training. For details about algorithm and the data set partitioning see <a href="https://machinelearningmastery.com/k-fold-cross-validation/">here</a>. </p>
<h4><a class="anchor" id="autotoc_md57"></a>
Hyper-parameter Tuning:</h4>
<p>Classes for hyper-parameter tuning. \ In some models, there are some parameters that can not be directly learnt, such as the <a href="https://towardsdatascience.com/ridge-regression-for-better-usage-2f19b3a202db">lambda</a> in ridge regression.\ Our goal is to offer grid search + cross validation method to select the hyper-parameter pair that give the best estimation. We will implement two grid search algorithm. One exhaustive. The other random.\ Exhaustive grid search:\ Given a (n, m), our tuning function will first generate all m^n pairs of parameters. Then we conduct cross validation on each pair to find the pair that produce the lowest error rate.\ Random grid search:\ Given a (n, m), our tuning function will first generate all m^n pairs of parameters. Then we randomly select k number of pairs and conduct cross validation on them. Finally, we return the best pair of parameters.\</p>
<h1><a class="anchor" id="autotoc_md58"></a>
Structures</h1>
<h2><a class="anchor" id="autotoc_md59"></a>
CosanMetric:</h2>
<p>Classes &amp; functions related to it:</p><ol type="1">
<li>CosanModels: predicted labels as one of the input</li>
<li>CosanBO: parent class</li>
<li>CosanData &amp; CosanMatrix: test labels</li>
</ol>
<p>Location: <code>cosan\evaluation\<a class="el" href="_cosan_metric_8h.html">CosanMetric.h</a></code> \ All the metric objects extend the base class <code>CosanMetric</code>. The arithmetic type for error rate is our self-defined data type, <a href="https://github.com/gchenra/cosan/blob/xinyu/design/MainDesignDoc.md#type">NumericType</a>. </p><div class="fragment"><div class="line">class CosanMetric</div>
<div class="line">    protected attribute</div>
<div class="line">        NumericType error</div>
<div class="line">    public functions:</div>
<div class="line">        default constructor: inherited from CosanBO</div>
<div class="line">        constructor1(CosanMatrix&amp; y1, CosanMatrix&amp; y2):</div>
<div class="line">            takes two CosanMatrices of shape (n,1)</div>
<div class="line">        void setAttr(CosanMatrix&amp; y1, CosanMatrix&amp; y2): </div>
<div class="line">            set the value of two attributes to given inputs and calculate the error rate</div>
<div class="line">    virtual functions:</div>
<div class="line">        NumericType GetError(): compute the error rate using different equations</div>
</div><!-- fragment --><p>Currently, the children classes only modify the <code>GetError</code> function of their base class (check our code base for details). The computations are powered by <a href="https://eigen.tuxfamily.org/dox/group__TutorialMatrixArithmetic.html">Eigen matrix arithmetic</a>.</p>
<h2><a class="anchor" id="autotoc_md60"></a>
Cross Validation:</h2>
<p>Classes &amp; functions related to it:</p><ol type="1">
<li>CosanModel: an instance of the model to be evaluated</li>
<li>CosanData &amp; CosanMatrix: two of cv's inputs. The preprocess data</li>
<li>CosanMetric: one of cv's inputs</li>
<li>KFold: use to split the dataset for cv</li>
</ol>
<p>Location: <code>cosan\selection\<a class="el" href="crossvalidation_8h.html">crossvalidation.h</a></code> \ The arithmetic type for error rate is our self-defined data type, <a href="https://github.com/gchenra/cosan/blob/xinyu/design/MainDesignDoc.md#type">NumericType</a>. Pseudocode: </p><div class="fragment"><div class="line">CrossValidateScore()</div>
<div class="line">    Input:</div>
<div class="line">    CosanModel&amp; model, </div>
<div class="line">    CosanData&amp; CRD</div>
<div class="line">    CosanMetric&amp; metric, </div>
<div class="line">    Split &amp; split,</div>
<div class="line">    int nthread, default -1</div>
<div class="line">    Output:</div>
<div class="line">        double, the mean of errors from each iteration</div>
<div class="line">    </div>
<div class="line">    errors = vector&lt;NumericType&gt; // get the size from split object</div>
<div class="line">    batch = split_with_k_fold(CRD.input(), CRD.target()) </div>
<div class="line">    // batch is a vector of k tuples. </div>
<div class="line">    // Inside each tuple are two vectors of indices assigned to training and testing</div>
<div class="line">    </div>
<div class="line">    for loop iterate through the batch</div>
<div class="line">        xTrain, yTrain, xTest, yTest = X(train_indices), Y(train_indices), X(test_indices), Y(test_indices)</div>
<div class="line">        model.fit(xTrain, yTrain)</div>
<div class="line">        yPredict = model.predict(xTest)</div>
<div class="line">        </div>
<div class="line">        errors.add(metric.GetError())</div>
<div class="line">    </div>
<div class="line">    return errors.mean()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
Hyper-parameter Tuning:</h2>
<p>Classes &amp; functions related to it:</p><ol type="1">
<li>CrossValidate: use to evaluate each parameter pair</li>
<li>CosanModel: an instance of the model to be evaluated</li>
<li>CosanData &amp; CosanMatrix: two of cv's inputs. The preprocess data</li>
<li>CosanMetric: one of cv's inputs</li>
</ol>
<p>Location: <code>cosan\selection\Search.h</code> \ Exhastive grid search Pseudocode: </p><div class="fragment"><div class="line">Class GridSearch: extends Search (Search class in selection.h)</div>
<div class="line">    private attribute:</div>
<div class="line">        Vector&lt;NumericType&gt; bestParam</div>
<div class="line">    public functions:</div>
<div class="line">        constructor(CosanData&amp; CRD, CosanModel&amp; model, CosanMetric&amp; metric, Split&amp; split, Vector&lt;NumericType&gt; paramGrid)</div>
<div class="line">            The first four arguments will be pass into the cross validation function. </div>
<div class="line">            This initializer will generate all possible pairs of hyperparameters and pass them one by one </div>
<div class="line">            into cross validation </div>
<div class="line">            then set the bestParam to be the best pair</div>
<div class="line">        auto getBestParams(): return the bestParam attribute</div>
</div><!-- fragment --><p>We also implemented a function to conduct grid search using parallelism (see <code>GridSearchParallel</code> in <code>cosan\selection\<a class="el" href="gridsearch_8h.html">gridsearch.h</a></code>). Note: we leave out the design of random grid search here. Compare with the exhaustive search, it only have one extra step to select random k pairs. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
